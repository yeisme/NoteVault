# NoteVault 存储模块设计

## 核心功能设计

### 1. 文件存储系统

- **多样化文件类型支持**: 系统设计上支持 Markdown、纯文本、图片（JPEG, PNG, GIF, SVG）、视频（MP4, AVI）、音频（MP3, WAV）等常见文件类型的上传、存储与管理。通过 `ContentType` 字段进行区分。
- **文件分块上传与断点续传**:
  - 支持将大文件分割成小块进行上传，提高上传成功率和用户体验。
  - 支持断点续传，在网络中断或其他异常情况下，可以从上次中断的地方继续上传，避免重复上传整个文件。
- **丰富的元数据管理**:
  - **基础信息**: 文件 ID、用户 ID、文件名、文件类型、MIME 类型、大小、存储路径。
  - **时间戳**: 创建时间、最后修改时间。
  - **业务信息**: 用户自定义标签、文件描述。
  - **版本信息**: 当前版本号。
- **存储安全与访问权限控制**:
  - 基于用户身份进行文件隔离。
  - 通过 JWT 等机制进行 API 访问鉴权。

#### 存储层设计

- **物理存储**: 本地文件系统或对象存储(如 MinIO/S3)
- **文件分区**: 按用户 ID 和文件类型划分存储区域
- **索引数据库**: 存储文件元数据和关系信息

#### 文件分块上传

- MinIO, JuiceFS 支持

### 2. 文件 CRUD 接口

- **RESTful API**: 提供标准化的文件创建 (Upload)、读取 (Download/Metadata)、更新 (Metadata)、删除 (Delete) 操作接口。
- **批量操作**: 支持文件的批量删除操作，提高管理效率。
- **分页与高级查询**:
  - 文件列表支持分页获取。
  - 支持按文件名、文件类型、用户标签、创建/修改时间范围进行检索和筛选。

### 3. 文件版本控制系统

- **多版本管理**: 自动或手动为文件的修改创建新版本，并保留历史版本记录。
- **版本历史追溯**: 可查看文件的完整版本列表，包括版本号、修改时间、大小、提交说明等。
- **版本回滚**: 支持将文件恢复到任意历史版本。
- **差异对比 (Diff)**: (高级功能) 支持比较两个版本之间的文本内容差异。
- **版本元数据**: 每个版本关联修改人（通过上传者或更新者间接关联）、修改时间、版本创建时的说明/备注。
- **冲突检测与合并策略**: (高级功能，初期简化) 对于并发修改，目前以上传时间为准，最后写入的覆盖。未来可引入更复杂的冲突检测和合并提示机制。

## API 接口设计

## 技术选型

- **后端**: Go (go-zero框架)
- **数据库**:
  - **元数据存储**: MySQL / PostgreSQL / SQLite
  - **索引**: meilisearch / typesense (可选, 用于高级搜索)
  - **ORM**: GORM
- **对象存储**: MinIO / JuiceFS / AWS S3 / 阿里云 OSS
- **消息队列**: Kafka / RabbitMQ / NATS (可选, 用于异步任务处理，如文件转码、索引更新)
- **缓存**: Redis (可选, 用于热点数据缓存)

## 部署架构

- **单体服务**: 初期可采用单体应用部署，简化运维。
- **微服务架构**: 随着业务发展，可将文件存储、元数据管理、版本控制等拆分为独立微服务。
- **容器化**: 使用 Docker 和 Kubernetes 进行容器化部署和管理。
- **网关**: API Gateway (如 Nginx, Kong, Traefik, Tyk) 统一入口，负责鉴权、路由、限流等。
